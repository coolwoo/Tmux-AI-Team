# PM 监督模式手动测试计划

> 测试目标：验证 pm-oversight 无参数方案及 PM 槽位管理功能

---

## 测试环境准备

```bash
# 确保函数已加载
source ~/.ai-automation.sh

# 检查依赖
check-deps

测试结果:
gary@DESKTOP-25KGMI5:~$ source ~/.ai-automation.sh
gary@DESKTOP-25KGMI5:~$ check-deps
┌─────────────────────────────────────────────────────────┐
│  AI 自动化工具包 - 环境检查                             │
├─────────────────────────────────────────────────────────┤
│ ✓ tmux 3.2a
│ ✓ claude (cld)
│ ✓ CODING_BASE: /home/gary/Coding
├─────────────────────────────────────────────────────────┤
│ ✓ at (自调度命令)
│ ✓ atd 服务运行中
│ ✓ git version 2.34.1
├─────────────────────────────────────────────────────────┤
│ ○ watch (可选 - 实时监控)
│ ○ 日志目录: /home/gary/.agent-logs
└─────────────────────────────────────────────────────────┘
状态: ✓ 就绪
gary@DESKTOP-25KGMI5:~$
```

---

## 阶段 1：基础启动

| 步骤 | 命令 | 预期结果 |
|------|------|----------|
| 1.1 | `fire test-pm` | 创建 tmux 会话，进入 Claude 窗口 |
| 1.2 | 观察 | Claude Code 已启动，显示提示符 |

---

## 阶段 2：PM 初始化

| 步骤 | 命令 | 预期结果 |
|------|------|----------|
| 2.1 | `/tmuxAI:pm-init` | 创建 dev-1 窗口，显示"初始化完成" |
| 2.2 | `pm-status` | 显示 dev-1 槽位，状态 ready |
| 2.3 | `pm-list-slots` | 输出 `dev-1` |

---

## 阶段 3：PM 监督模式激活（重点测试）

| 步骤 | 命令 | 预期结果 |
|------|------|----------|
| 3.1 | `/tmuxAI:pm-oversight` | **无需参数**，自动执行 pm-status |
| 3.2 | 观察输出 | 显示当前槽位状态面板 |
| 3.3 | 观察行为 | 根据状态给出下一步建议 |

---

## 阶段 4：任务分配

| 步骤 | 命令 | 预期结果 |
|------|------|----------|
| 4.1 | `pm-assign dev-1 developer "echo 测试任务"` | 向 dev-1 发送任务 |
| 4.2 | `pm-status` | dev-1 状态变为 working |
| 4.3 | 切换到 dev-1 窗口观察 | 收到任务消息 |

---

## 阶段 5：状态检测

| 步骤 | 命令 | 预期结果 |
|------|------|----------|
| 5.1 | 在 dev-1 窗口输出 `[STATUS:DONE] 测试完成` | - |
| 5.2 | 回到 Claude 窗口 | - |
| 5.3 | `pm-check dev-1` | 检测到 DONE 状态，自动标记 |
| 5.4 | `pm-status` | dev-1 状态变为 done |

---

## 阶段 6：槽位扩展

| 步骤 | 命令 | 预期结果 |
|------|------|----------|
| 6.1 | `pm-add-slot dev-2 --claude` | 创建 dev-2 槽位，启动 Claude |
| 6.2 | `pm-add-slot qa --claude` | 创建 qa 槽位 |
| 6.3 | `pm-status` | 显示 3 个槽位 |
| 6.4 | `pm-list-slots` | 输出 `dev-1,dev-2,qa` |

---

## 阶段 7：通信测试

| 步骤 | 命令 | 预期结果 |
|------|------|----------|
| 7.1 | `tsc test-pm:dev-1 "PM 发来的消息"` | dev-1 收到带前缀的消息 |
| 7.2 | `pm-broadcast "全体注意"` | 所有 working 槽位收到消息 |

---

## 阶段 8：自调度测试（可选）

| 步骤 | 命令 | 预期结果 |
|------|------|----------|
| 8.1 | `schedule-checkin 1 "测试唤醒"` | 创建 at 任务 |
| 8.2 | `atq` | 显示待执行任务 |
| 8.3 | 等待 1 分钟 | 收到"继续工作"消息 |

---

## 阶段 9：清理

| 步骤 | 命令 | 预期结果 |
|------|------|----------|
| 9.1 | `pm-history` | 显示所有 PM 操作记录 |
| 9.2 | 退出 tmux | `Ctrl+b d` 或 `exit` |
| 9.3 | `tmux kill-session -t test-pm` | 清理测试会话 |

---

## 快速测试脚本

```bash
# 一键启动测试环境
fire test-pm

# 在 Claude 中依次执行：
/tmuxAI:pm-init
/tmuxAI:pm-oversight
pm-assign dev-1 developer "echo hello"
pm-status
pm-check dev-1
```

---

## 重点验证项

| 验证点 | 通过标准 |
|--------|----------|
| pm-oversight 无参数 | 直接激活，不报参数错误 |
| pm-oversight 自动检查状态 | 执行后显示 pm-status 输出 |
| 槽位状态同步 | pm-assign 后状态变 working |
| 状态标记检测 | [STATUS:DONE] 被正确解析 |
| 消息溯源 | tsc 发送的消息带 [窗口名] 前缀 |

---

## 测试结果记录

| 阶段 | 结果 | 备注 |
|------|------|------|
| 1. 基础启动 | [ ] 通过 / [ ] 失败 | |
| 2. PM 初始化 | [ ] 通过 / [ ] 失败 | |
| 3. PM 监督激活 | [ ] 通过 / [ ] 失败 | |
| 4. 任务分配 | [ ] 通过 / [ ] 失败 | |
| 5. 状态检测 | [ ] 通过 / [ ] 失败 | |
| 6. 槽位扩展 | [ ] 通过 / [ ] 失败 | |
| 7. 通信测试 | [ ] 通过 / [ ] 失败 | |
| 8. 自调度 | [ ] 通过 / [ ] 失败 | |

测试日期：__________
测试人员：__________
